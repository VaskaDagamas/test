<!DOCTYPE html>
<html>
<head>
	<title></title>
	<script type="text/javascript" src="jquery-2.2.4.js"></script>
</head>
<body>
<p class="answer" ></p>
<script type="text/javascript">
$.ajax("http://ftt.elsyton.com").then(function(task){
	console.log("result", task); //смотрим, что получили
	console.log("id", task.id); //проверяем, что получили
	var links = [];//содаем массив
	for (var i=0;i<task.trees.length;i++) {
		var pairs = [];//создаем массив
		dig_branch(task.trees[i], 0, pairs);//парсим дерево
		links.push(pairs);//ложим в массив
	}

	console.log("links", links);  //проверяем, что вышло
	

	$.ajax({
		url: "http://ftt.elsyton.com",//адрес
		data: JSON.stringify({id: task.id, links: links}),//информация
		dataType: "json",//формат
		headers: {"Content-Type": "application/jsonp"},//заголовок
		xhrFields: {
		 	withCredentials: false
		},
		type: "POST"
	}).then(function(check){
		console.log("check", check); //смотрим, что получили
		answer();//проверяем ответ
		
	})
});

function dig_branch(item, level, pairs) {//начинаем исследовать
	const sub_keys = ["right", "left"];  

	for (var i=0;i<sub_keys.length;i++) {
		var branch = item[sub_keys[i]];
		if (branch && branch!==null) {
			if (typeof pairs[level] === 'undefined')
				pairs[level] = [];

			pairs[level].push(branch.id);
		}
	}
	
	for (var i=0;i<sub_keys.length;i++) {
		var branch = item[sub_keys[i]];
		if (branch) {
			dig_branch(branch, level+1, pairs);
		}
	}
}
var links = [];
dig_branch(links, 0, links);

var check = {
  name: "Вася",
  age: 25,
  roles: {
    isAdmin: false,
    isEditor: true
  }
};
ch = JSON.stringify(check);
answer();

function answer(){
	ka = JSON.parse(ch,function(key,value){
		$(".answer").html("<span class='animated bouce' style='color:green'>ok</span");
		if (value == false) {
			$(".answer").html("<span class='animated bouce'  style='color:red'>error</span");
		}
				
	});
};


</script>
<style type="text/css">
	body{
		background: #61b6e7;
		position: relative;
		width: 100%;
		height: 100vh;
		overflow: hidden;
	}
	.answer{
		position: absolute;
		top: 0px;
		bottom: 0px;
		left: 0px;
		right: 0px;
		font-size: 26pt;
		margin: auto;
		text-align: center;
		width: 300px;
		height: 26pt;
	}
	.animated {
	  -webkit-animation-duration: 1s;
	  animation-duration: 1s;
	  -webkit-animation-fill-mode: both;
	  animation-fill-mode: both;
	}
	

	.bounce {
	  -webkit-animation-name: bounce;
	  animation-name: bounce;
	  -webkit-transform-origin: center bottom;
	  transform-origin: center bottom;
	}
	@-webkit-keyframes bounce {
	  from, 20%, 53%, 80%, to {
	    -webkit-animation-timing-function: cubic-bezier(0.215, 0.610, 0.355, 1.000);
	    animation-timing-function: cubic-bezier(0.215, 0.610, 0.355, 1.000);
	    -webkit-transform: translate3d(0,0,0);
	    transform: translate3d(0,0,0);
	  }

	  40%, 43% {
	    -webkit-animation-timing-function: cubic-bezier(0.755, 0.050, 0.855, 0.060);
	    animation-timing-function: cubic-bezier(0.755, 0.050, 0.855, 0.060);
	    -webkit-transform: translate3d(0, -30px, 0);
	    transform: translate3d(0, -30px, 0);
	  }

	  70% {
	    -webkit-animation-timing-function: cubic-bezier(0.755, 0.050, 0.855, 0.060);
	    animation-timing-function: cubic-bezier(0.755, 0.050, 0.855, 0.060);
	    -webkit-transform: translate3d(0, -15px, 0);
	    transform: translate3d(0, -15px, 0);
	  }

	  90% {
	    -webkit-transform: translate3d(0,-4px,0);
	    transform: translate3d(0,-4px,0);
	  }
	}

	@keyframes bounce {
	  from, 20%, 53%, 80%, to {
	    -webkit-animation-timing-function: cubic-bezier(0.215, 0.610, 0.355, 1.000);
	    animation-timing-function: cubic-bezier(0.215, 0.610, 0.355, 1.000);
	    -webkit-transform: translate3d(0,0,0);
	    transform: translate3d(0,0,0);
	  }

	  40%, 43% {
	    -webkit-animation-timing-function: cubic-bezier(0.755, 0.050, 0.855, 0.060);
	    animation-timing-function: cubic-bezier(0.755, 0.050, 0.855, 0.060);
	    -webkit-transform: translate3d(0, -30px, 0);
	    transform: translate3d(0, -30px, 0);
	  }

	  70% {
	    -webkit-animation-timing-function: cubic-bezier(0.755, 0.050, 0.855, 0.060);
	    animation-timing-function: cubic-bezier(0.755, 0.050, 0.855, 0.060);
	    -webkit-transform: translate3d(0, -15px, 0);
	    transform: translate3d(0, -15px, 0);
	  }

	  90% {
	    -webkit-transform: translate3d(0,-4px,0);
	    transform: translate3d(0,-4px,0);
	  }
	}
</style>

</body>
</html>